{% extends "./Common/layout_view.html" %}
{% block content %}

<div id="carouselExampleSlidesOnly" class="carousel slide" data-bs-ride="carousel">
    <div class="carousel-inner">
        <div class="carousel-item active">
            <img src="{{ booking.movie.detailbanneraddress }}" class="d-block w-100" alt="...">
        </div>
    </div>
</div>

<div class="container mt-5">
    <input type="hidden" id="movieid" value="{{ booking.movie.id }}">
    <input type="hidden" id="screeningid" value="{{ booking.screening.id }}">

    <h1 class="text-center title">{{ booking.movie.title }}</h1>
    <h2 class="text-center title">{{ booking.screening.date }} {{ booking.screening.starttime}}</h2>
    <h2 class="text-center subtitle">Cinema Seat Selection</h2>
    <div class="legend">
        <div class="seat occupied"></div>
        <p>Occupied</p>
        <div class="seat"></div>
        <p>Available</p>
    </div>
    <div class="text-center">
        <button id="checkout" class="btn btn-primary mt-2">Checkout</button>
    </div>
    <div class="row mt-3" >
        <div class="col-md-6 offset-md-4" style="width: 450px;">
            <div id="seats" class="d-flex flex-wrap" ></div>
        </div>
    </div>
</div>

<script>
    const seatsContainer = document.getElementById("seats");
    const checkoutButton = document.getElementById("checkout");

    const totalRows = 5; // Total number of rows
    const seatsPerRow = 10; // Seats per row
    let selectedSeats = [];
    const bookedSeats = [   
        { row: 2, seat: 3 },
        { row: 3, seat: 5 },
        { row: 1, seat: 7 },
        // Add more booked seats as needed
    ];

    for (let rowNumber = 1; rowNumber <= totalRows; rowNumber++) {
        for (let seatNumber = 1; seatNumber <= seatsPerRow; seatNumber++) {
            const seat = document.createElement("div");
            seat.className = "seat";
            seat.style.width = "30px";  
            seat.style.height = "30px"; 
            seat.dataset.rowNumber = rowNumber;
            seat.dataset.seatNumber = seatNumber;

            if (isSeatBooked(rowNumber, seatNumber)) {
                seat.classList.add("occupied");
            }

            seat.addEventListener("click", () => {
                if (seat.classList.contains("selected")) {
                    seat.classList.remove("selected");
                    const index = selectedSeats.findIndex(seat => seat.row === rowNumber && seat.seat === seatNumber);
                    if (index > -1) {
                        selectedSeats.splice(index, 1);
                    }
                } else if (!seat.classList.contains("occupied")) {
                    seat.classList.add("selected");
                    selectedSeats.push({ row: rowNumber, seat: seatNumber });
                }
            });

            seatsContainer.appendChild(seat);
        }
    }

    const movieid = document.getElementById("movieid").value;
    const screeningid = document.getElementById("screeningid").value;

    const requestData = {
        movieid: movieid,
        screeningid: screeningid,
        selectedSeats: selectedSeats,
    };

    checkoutButton.addEventListener("click", () => {
        // Send selected seats data to the server
        fetch("{{ url_for('select_seats') }}", {
            method: "POST",
            body: JSON.stringify(requestData),
            headers: {
                "Content-Type": "application/json",
            },
        })
            .then(response => response.json())
            .then(data => {
                alert(`You selected ${data.length} seat(s).`);
            });
    });

    function isSeatBooked(row, seat) {
        // Check if the seat is booked based on the provided booked seats data
        return bookedSeats.some(bookedSeat => bookedSeat.row === row && bookedSeat.seat === seat);
    }
</script>

<style>
    .container {
        text-align: center;
    }
    .seat {
        width: 30px;
        height: 30px;
        margin: 5px;
        background-color: #ccc;
        border: 1px solid #777;
        cursor: pointer;
    }
    .selected {
        background-color: #007BFF;
        color: #fff;
    }
    .occupied {
        background-color: #FF0000;
        color: #fff;
    }
    .available {
        background-color: #ccc;
    }
    .legend {
            display: flex;
            align-items: center;
            justify-content: center;
            margin-top: 10px;
    } 
    .title {
            font-size: 24px;
            font-weight: bold;
    }
    .subtitle {
        font-size: 20px;
    }
</style>

{% endblock %}